@page "/"
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
<link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />

<h1>DM Power Tools</h1>

<label  style="
        box-shadow: 0 2px 7px #4caf50;
        display: inline-flex;
        width: 150px;
        justify-content: space-around;
        border-radius: 2em;
        color: white;
        border:2px solid;
        cursor: pointer;
        align-items: center;
        padding:16px;
        background-color: #4caf50;"         
       for="fileInput2">
    Upload Monster <MudIcon Icon="@Icons.Filled.CloudUpload"/>
</label>

<InputFile id="fileInput2" OnChange="UploadFiles" hidden multiple />

@code
{
    @inject ApplicationDbContext DbContext
    @using DMPowerTools.Data;
    @using System.Text.Json;

    private async void UploadFiles(InputFileChangeEventArgs e)
    {
        var monsters = new List<Monster>();
        foreach (IBrowserFile f in e.GetMultipleFiles())
        {
            var monster = await JsonSerializer.DeserializeAsync<Monster>(f.OpenReadStream(512000, default), new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            });
            monsters.Add(monster);
        }
        try
        {
            DbContext.Monsters.AddRange(monsters);
            await DbContext.SaveChangesAsync();
        }
        catch (Exception tree)
        {
            var boo = tree.Message;

        }

        
    }
}